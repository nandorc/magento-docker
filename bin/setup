#!/bin/bash

# Create .bashrc and .bash_profile if needed on Git Bash
if [ -n "${WINDIR}" ]; then
  if [ ! -f ~/.bash_profile ]; then
    echo "# generated by Git for Windows" >>~/.bash_profile
    echo "test -f ~/.profile && . ~/.profile" >>~/.bash_profile
    echo "test -f ~/.bashrc && . ~/.bashrc" >>~/.bash_profile
  fi
  if [ ! -f ~/.bashrc ]; then
    echo "[ -f ~/.bash_aliases ] && source ~/.bash_aliases" >>~/.bashrc
  fi
fi

alias_command='last_mage_path=""; [ -f ./mage ] && last_mage_path="./mage"; [ -f ./bin/mage ] && last_mage_path="./bin/mage"; [ -z "${last_mage_path}" ] && echo "ERR~ mage not found" || $last_mage_path'
[ ! -f ~/.bash_aliases ] && touch ~/.bash_aliases
[ -n "$(cat ~/.bash_aliases | grep "^alias mage=")" ] && sed -i -e "/^alias mage=/d" ~/.bash_aliases
echo "alias mage='${alias_command}'" >>~/.bash_aliases

if [ $? -eq 0 ]; then
  [ -n "${WINDIR}" ] && echo -e "WRN~ Must close and reopen window to apply changes or type 'source ~/.bash_aliases'" || newgrp
fi
